<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Médico – Queimadas Telemedicina</title>
  <style>
    :root{
      --azul:#0c2e4e;
      --bolha:#e7f1ff;
      --bolha-user:#d8f7e5;
      --borda:#cfe0ff;
      --verde:#0c9447;
    }
    body{
      margin:0; background:#f6f8fb; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; color:#0b1b2b;
    }
    header{
      background:var(--azul); color:#fff; padding:8px 12px 16px;
      display:flex; flex-direction:column; align-items:center; gap:8px;
    }
    header .banner{ width:100%; max-width:1100px; border-radius:8px; overflow:hidden; }
    header h1{ font-size: clamp(18px, 3.8vw, 28px); margin: 6px 0 0; font-weight:700; }
    .wrap{
      max-width: 980px; margin: 12px auto; padding: 0 12px;
    }
    .chat{
      background:#fff; border:1px solid #e6ebf5; border-radius:12px; padding:12px; min-height:50vh;
      display:flex; flex-direction:column; gap:10px;
    }
    .msg{
      max-width: 85%; border-radius:14px; padding:12px 14px; line-height:1.35; font-size:16px;
      border:1px solid var(--borda);
      box-shadow: 0 1px 0 rgba(10,30,60,.03);
    }
    .m-med{ background: var(--bolha); align-self:flex-start; }
    .m-user{ background: var(--bolha-user); align-self:flex-end; }
    .status{ align-self:center; font-size:14px; color:#375; padding:4px 10px; background:#eefbf3; border-radius:999px; border:1px solid #d3f1e2; }
    .rodape{
      display:flex; gap:10px; margin-top:10px; align-items:center; flex-wrap:wrap;
    }
    .rodape .filebtn{ background:var(--azul); color:#fff; border:none; padding:12px 14px; border-radius:12px; font-weight:600; }
    .rodape input[type="file"]{ display:none; }
    .rodape .inpt{ flex:1 1 240px; border:1px solid #cfd8ea; border-radius:12px; padding:12px 14px; font-size:16px; }
    .rodape .send{ background:#0e8240; color:#fff; border:none; padding:12px 20px; border-radius:12px; font-weight:700; }
    .logo-rodape{ display:block; margin:10px auto 0; opacity:.9; max-width:220px; }
    @media (max-width:480px){
      .msg{ font-size:15px; }
    }
  </style>
<style>.toplink{position:absolute;right:16px;top:12px;font-weight:700} .toplink a{color:#0e8240;text-decoration:none}</style>
<style>.sitefoot{max-width:920px;margin:30px auto 20px;text-align:center;color:#6b7899;font-size:12px} .sitefoot a{color:#6b7899;text-decoration:none}</style>
<style>.hello{margin-right:10px;color:#0e8240}</style>
</head>
<body>
  <header>
    <img class="banner" src="prefeitura-queimadas.jpg" alt="Prefeitura de Queimadas" />
    <h1>Queimadas Telemedicina</h1>
  <nav class="toplink"><span id="lkName" class="hello" style="display:none"></span> <a href="history.html" id="lkHist" style="display:none">Meu histórico</a> &nbsp;•&nbsp; <a href="#" id="lkLogout" style="display:none">Sair</a></nav></header>

  <main class="wrap">
    <section class="chat" id="chat"></section>

    <div class="rodape">
      <label class="filebtn">
        Enviar arquivo
        <input id="file" type="file" accept="image/*,.pdf,.jpg,.jpeg,.png" />
      </label>
      <input id="msg" class="inpt" placeholder="Escreva sua resposta..." />
      <button id="send" class="send">Enviar</button>
    </div>

    <img class="logo-rodape" src="atende-mais.png" alt="Atende Mais" />
  </main>

  







<script type="module">
try{
  const lkHist = document.getElementById('lkHist');
  const lkLogout = document.getElementById('lkLogout');
  const lkName = document.getElementById('lkName');
  const mod = await import('./auth.js');
  const { isAuthed, logout, api } = mod;

  async function refreshName(){
    if(!lkName) return;
    if(!isAuthed()){ lkName.style.display='none'; return; }
    let nm = localStorage.getItem('pacienteNome')||'';
    if(!nm){
      try{ const d = await api('/auth/me'); nm = (d.user && d.user.name) ? d.user.name : ''; if(nm) localStorage.setItem('pacienteNome', nm); }catch(_){}
    }
    if(nm){
      const first = nm.split(' ')[0];
      lkName.textContent = 'Olá, ' + first;
      lkName.style.display = 'inline';
    }else{
      lkName.style.display = 'none';
    }
  }

  function update(){
    const authed = isAuthed();
    if(lkHist){ authed ? lkHist.style.removeProperty('display') : (lkHist.style.display='none'); }
    if(lkLogout){ authed ? lkLogout.style.removeProperty('display') : (lkLogout.style.display='none'); }
    refreshName();
  }

  update();
  window.addEventListener('auth-changed', update);
  window.addEventListener('storage', (e)=>{ if(e.key==='AUTH_TOKEN' || e.key==='pacienteNome') update(); });

  if(lkLogout){
    lkLogout.addEventListener('click', (e)=>{
      e.preventDefault();
      if(!isAuthed()) return;
      const ok = window.confirm('Deseja realmente sair?');
      if(!ok) return;
      try{ localStorage.removeItem('pacienteNome'); localStorage.removeItem('pacienteCPF'); }catch{}
      logout();
      const priv = /receptionist\.html|paciente\.html|medico\.html|history\.html/i.test(location.pathname);
      if(priv) location.replace('login.html'); else update();
    });
  }
}catch(_e){}
</script>

</body>
</html>
