<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Conectando ao médico…</title>
  <link rel="stylesheet" href="style.css">
<style>.toplink{position:absolute;right:16px;top:12px;font-weight:700} .toplink a{color:#0e8240;text-decoration:none}</style>
<style>.sitefoot{max-width:920px;margin:30px auto 20px;text-align:center;color:#6b7899;font-size:12px} .sitefoot a{color:#6b7899;text-decoration:none}</style>
</head>
<body>
<header>
  <img class="qbanner" src="prefeitura-queimadas.jpg" alt="Prefeitura de Queimadas">
  <h1>Queimadas Telemedicina</h1>
<nav class="toplink"><a href="history.html">Meu histórico</a></nav></header>
<main>
<div class="chat"><div class="msg recep">Preparando sua sala com o médico…</div></div>
<footer class="atende"><img src="atende-mais.png" alt="Atende+"></footer>
</main>
<script type="module">
import { requireAuth } from "./auth.js";
requireAuth();
const API_BASE = (localStorage.getItem('API_BASE')||'https://remedy-queimadas-api.onrender.com');
(function start(){
  // Proteção de fluxo: sem triagem -> volta para recepção
  if(!localStorage.getItem('triageComplete') || !localStorage.getItem('selectedSpecialty')){
    location.replace('receptionist.html'); return;
  }
  const specialty = localStorage.getItem('selectedSpecialty');
  fetch(API_BASE+'/api/session',{
    method:'POST',headers:{'Content-Type':'application/json'},
    body:JSON.stringify({specialty})
  }).then(r=>r.json()).then(d=>{
    localStorage.setItem('sessionId', d.sessionId||'');
    location.replace('medico.html');
  }).catch(()=>{
    // mesmo que a API caia, segue para a sala (o médico vai avisar erro)
    location.replace('medico.html');
  });
})();
</script>

<footer class="sitefoot"><a href="admin.html" title="Acesso restrito ao médico">Acesso do médico</a></footer>
</body>
</html>
