<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Recepção – Queimadas Telemedicina</title>
<link rel="stylesheet" href="style.css">
<style>.toplink{position:absolute;right:16px;top:12px;font-weight:700} .toplink a{color:#0e8240;text-decoration:none}</style>
<style>.sitefoot{max-width:920px;margin:30px auto 20px;text-align:center;color:#6b7899;font-size:12px} .sitefoot a{color:#6b7899;text-decoration:none}</style>
<style>.hello{margin-right:10px;color:#0e8240}</style>
</head>
<body>
  <header>
    <img class="qbanner" src="prefeitura-queimadas.jpg" alt="Prefeitura de Queimadas">
    <h1>Queimadas Telemedicina</h1>
  <nav class="toplink"><span id="lkName" class="hello" style="display:none"></span> <a href="history.html" id="lkHist" style="display:none">Meu histórico</a> &nbsp;•&nbsp; <a href="#" id="lkLogout" style="display:none">Sair</a></nav></header>

  <main>
    <div id="chat" class="chat" aria-live="polite">
      <div class="msg recep" id="welcome">Recepção está digitando…</div>
      <div id="especialidades" class="msg recep" style="display:none">
        <div><strong>Selecione a especialidade para direcionarmos ao médico:</strong></div>
        <div id="lista-esp"></div>
      </div>
      <div id="pre-transfer" class="msg recep" style="display:none"></div>
      <div id="aguarde" class="msg system" style="display:none"></div>
    </div>

    <footer class="atende"><img src="atende-mais.png" alt="Atende+"></footer>
    <div class="legal">
      Base legal da Telemedicina no Brasil (resumo): legislação federal vigente e normas do CFM
      (ex.: Resolução CFM 2.314/2022), com observância à LGPD (Lei 13.709/2018). Atendimento
      remoto com registro em prontuário, identificação das partes e consentimento informado.
    </div>
  </main>









<script type="module">
try{
  const lkHist = document.getElementById('lkHist');
  const lkLogout = document.getElementById('lkLogout');
  const lkName = document.getElementById('lkName');
  const mod = await import('./auth.js');
  const { isAuthed, logout, api } = mod;

  async function refreshName(){
    if(!lkName) return;
    if(!isAuthed()){ lkName.style.display='none'; return; }
    let nm = localStorage.getItem('pacienteNome')||'';
    if(!nm){
      try{ const d = await api('/auth/me'); nm = (d.user && d.user.name) ? d.user.name : ''; if(nm) localStorage.setItem('pacienteNome', nm); }catch(_){}
    }
    if(nm){
      const first = nm.split(' ')[0];
      lkName.textContent = 'Olá, ' + first;
      lkName.style.display = 'inline';
    }else{
      lkName.style.display = 'none';
    }
  }

  function update(){
    const authed = isAuthed();
    if(lkHist){ authed ? lkHist.style.removeProperty('display') : (lkHist.style.display='none'); }
    if(lkLogout){ authed ? lkLogout.style.removeProperty('display') : (lkLogout.style.display='none'); }
    refreshName();
  }

  update();
  window.addEventListener('auth-changed', update);
  window.addEventListener('storage', (e)=>{ if(e.key==='AUTH_TOKEN' || e.key==='pacienteNome') update(); });

  if(lkLogout){
    lkLogout.addEventListener('click', (e)=>{
      e.preventDefault();
      if(!isAuthed()) return;
      const ok = window.confirm('Deseja realmente sair?');
      if(!ok) return;
      try{ localStorage.removeItem('pacienteNome'); localStorage.removeItem('pacienteCPF'); }catch{}
      logout();
      const priv = /receptionist\.html|paciente\.html|medico\.html|history\.html/i.test(location.pathname);
      if(priv) location.replace('login.html'); else update();
    });
  }
}catch(_e){}
</script>

</body>
</html>

<script type="module">
document.addEventListener("keydown", (e)=>{
  const el = e.target;
  if((el.tagName==="INPUT" || el.tagName==="TEXTAREA") && e.key==="Enter"){
    const v = (el.value||"").trim();
    if(containsForbiddenIA(v)){
      e.preventDefault();
      alert(STD_REPLY);
    }
  }
});
</script>
